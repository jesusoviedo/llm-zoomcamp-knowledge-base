# Semana 2 - LLM Zoomcamp

Este documento recopila mis apuntes y recursos para la **Semana 2** del curso LLM Zoomcamp.

## üìù Notas de la teor√≠a

### Busqueda Vectorial

La b√∫squeda vectorial permite encontrar objetos similares transform√°ndolos en vectores de alta dimensi√≥n y compar√°ndolos en funci√≥n de su cercan√≠a en ese espacio. Qdrant es una base de datos open‚Äësource escrita en Rust, dise√±ada para realizar esa b√∫squeda de manera r√°pida y escalable

**Vectores**

En aprendizaje autom√°tico, un vector es una representaci√≥n num√©rica de un objeto complejo (texto, imagen, usuario, etc.) en un espacio multidimensional. Si imaginas cada dato como una canci√≥n, el vector ser√≠a la partitura que resume su melod√≠a sem√°ntica.

**M√©tricas de similitud**

Comparar vectores es medir distancias:
- Similitud del coseno: compara la orientaci√≥n de dos vectores (√°ngulo).
- Distancia Euclidiana: mide la distancia ‚Äúdirecta‚Äù en el espacio.
- Producto escalar: correlaciona vectores en funci√≥n de su producto escalar.

**B√∫squeda sem√°ntica y disimilitud**

- B√∫squeda de similitud sem√°ntica: encuentra vectores cercanos al vector de consulta, como buscar estrellas de la misma constelaci√≥n.
- B√∫squeda por disimilitud: selecciona vectores lejanos, √∫til para detecci√≥n de anomal√≠as.

**B√∫squeda de diversidad**

Algunos casos requieren variedad. Una manera ser√≠a filtrar resultados muy cercanos entre s√≠ (‚Äúvecinos ruidosos‚Äù), garantizando que los resultados sean sem√°nticamente distintos entre s√≠.


**Recomendaciones basadas en vectores**
* Recomendaciones de caracter√≠sticas vectoriales: almacenamos vectores de usuarios y productos. Luego, al comparar vectores similares, sugerimos √≠tems que est√°n cerca en ese espacio.

* Recomendaciones de distancia relativa: no se trata solo de encontrar los m√°s similares, sino de medir "lo suficientemente cerca" respecto al promedio, usando filtros din√°micos y normalizaci√≥n dentro del espacio vectorial.

**Descubrimiento**

Encuentros inesperados son posibles gracias a la diversidad vectorial: descubrir relaciones no evidentes entre documentos, temas o productos.

### Qdrant: Motor de B√∫squeda Vectorial Sem√°ntica

Qdrant (Quadrant) es un **motor de base de datos vectorial de alto rendimiento** dise√±ado para b√∫squedas sem√°nticas, recuperaci√≥n de informaci√≥n por similitud y aplicaciones de inteligencia artificial. Est√° optimizado para manejar **incrustaciones vectoriales** generadas por modelos de machine learning y proporciona una API eficiente para realizar b√∫squedas de vecinos m√°s cercanos (k-NN) de manera precisa, r√°pida y escalable.

Qdrant permite almacenar vectores densos (embeddings) junto con **metadatos** estructurados, habilitando b√∫squedas h√≠bridas: **vectoriales** (por similitud sem√°ntica) y **filtradas** (por condiciones estructuradas). Es ideal para aplicaciones como:

- RAG (Retrieval-Augmented Generation)
- Recomendadores
- Motores de b√∫squeda sem√°ntica
- Chatbots con contexto vectorial

#### **Caracter√≠sticas Principales**

- Soporte de vectores de alta dimensi√≥n:
- B√∫squeda aproximada y exacta (HNSW, Brute Force)
- Filtros por metadatos estructurados
- Indexaci√≥n incremental y tiempo real
- Optimizado para CPU y disponible con soporte para GPU
- Integraci√≥n con FastEmbed y frameworks de ML/IA
- Soporta m√∫ltiples colecciones y namespaces.
- API REST y gRPC.
- Persistencia en disco o en memoria.

#### **Arquitectura**

![alt text](./img/image.png)

- Motor de b√∫squeda HNSW (Hierarchical Navigable Small World): estructura de grafo eficiente para b√∫squedas vectoriales aproximadas.
- Gesti√≥n de Payloads: cada vector puede tener metadatos adjuntos para filtrado sem√°ntico estructurado.
- Shard Manager: cuando se usa en cl√∫ster, balancea y distribuye datos entre nodos.

#### **Almacenamiento de Datos: Colecciones y Puntos**

Qdrant organiza los datos en **colecciones**, similares a las tablas en una base de datos relacional. Cada colecci√≥n agrupa un conjunto de vectores y su informaci√≥n asociada.

![alt text](./img/image_2.png)

*Colecci√≥n*

Una colecci√≥n representa un espacio de b√∫squeda aislado con su propio √≠ndice, configuraci√≥n y datos. Puedes tener m√∫ltiples colecciones, por ejemplo: `faq_articles`, `legal_docs` y `product_catalog`

Cada colecci√≥n define:

- El tama√±o de los vectores (dimensionalidad)
- La m√©trica de similitud (`Cosine`, `Euclidean`, `Dot`)
- Opcionalmente, si usa HNSW u otro tipo de indexado

*Punto*

Los datos dentro de una colecci√≥n se almacenan como puntos (PointStruct). Cada punto es un objeto que representa un vector en el espacio sem√°ntico y contiene:
- `id`: identificador √∫nico del punto (entero o UUID)
- `vector`: array de floats (el embedding)
- `payload`: diccionario de metadatos JSON asociados al vector

Este dise√±o permite, realizar b√∫squedas vectoriales por similitud sobre `vector` y filtrar por metadatos estructurados contenidos en `payload`

Los `puntos` se pueden insertar individualmente o por lotes (`batch upsert`) usando la API o el cliente oficial (`qdrant-client` para Python).

*Indexaci√≥n*

Una vez insertados, los puntos pueden ser indexados autom√°ticamente por el motor HNSW (si est√° habilitado) o buscados mediante fuerza bruta (Brute Force) si no hay √≠ndice disponible. Los √≠ndices permiten acelerar la b√∫squeda de vectores similares sin recorrer todos los datos.

#### **Funcionalidades Clave**

- `search`: buscar por similitud vectorial.
- `recommend`: sugerencias basadas en vectores positivos y negativos.
- `scroll`: recuperaci√≥n paginada.
- `filter`: b√∫squedas filtradas por metadatos (ej. categor√≠a, fecha).
- `payload`: adjuntar informaci√≥n extra (JSON) a los vectores.
- `update/delete`: modificaciones en tiempo real.
- `collections`: m√∫ltiples espacios de trabajo aislados.
- `snapshots/backups`: gesti√≥n de respaldo y restauraci√≥n.

#### **Seguridad**

- Autenticaci√≥n basada en tokens (a partir de la versi√≥n 1.5).
- Control de acceso a endpoints v√≠a configuraci√≥n de API keys.
- Comunicaciones seguras mediante TLS (cuando se usa proxy o configuraci√≥n externa).
- Integrable con firewalls, proxies y servicios de autenticaci√≥n externos.

#### **Alta Disponibilidad y Redundancia**

- Modo Cl√∫ster (Enterprise o Community):
    - Distribuci√≥n horizontal de shards en m√∫ltiples nodos.
    - Replicaci√≥n de shards para tolerancia a fallos.
    - Rebalanceo autom√°tico ante cambios de topolog√≠a.
- Backups y snapshots peri√≥dicos para recuperaci√≥n de desastres.
- Qdrant Cloud ofrece despliegue gestionado con SLA, HA y escalado autom√°tico.

### üõ†Ô∏è Ejemplo pr√°ctico de Qdrant

**Creaci√≥n de un entorno de desarrollo**

Para crear y gestionar el entorno de Python de este proyecto se utiliza `uv`, una herramienta moderna que combina la gesti√≥n de entornos virtuales y la resoluci√≥n de dependencias de forma r√°pida y eficiente.

Este enfoque reemplaza el uso tradicional de herramientas como `venv`, `pip` y `virtualenv`, ofreciendo una experiencia m√°s simple y √°gil.

‚ÑπÔ∏è Para m√°s detalles sobre c√≥mo instalar y utilizar uv, consulta el archivo [`working-with-uv.md`](../docs/working-with-uv.md)

Una vez instalado `uv`, puedes crear el entorno virtual e instalar todas las dependencias necesarias con un solo comando:

```bash
uv venv && uv sync
```

Este comando crear√° un entorno virtual en el directorio del proyecto y sincronizar√° las librer√≠as especificadas en el archivo `pyproject.toml`.

**Interactuando con Qdrant usando Python**

**1. Descargar la imagen de Qdrant desde Docker Hub**

```bash
docker pull qdrant/qdrant
```

**2. Ejecutar el servicio**

```bash
docker run -p 6333:6333 -p 6334:6334 \
    -v "$(pwd)/qdrant_storage:/qdrant/storage:z" \
    qdrant/qdrant
```

Con esta configuraci√≥n predeterminada, todos los datos se almacenar√°n en el directorio  `./qdrant_storage`, el cual ser√° accesible tanto para el contenedor como para el host.

Qdrant ahora estar√° disponible en:
- API REST: http://localhost:6333
- Interfaz web: http://localhost:6333/dashboard
- API gRPC: http://localhost:6334

**3. Flujo b√°sico**

Si deseas ver un ejemplo pr√°ctico de c√≥mo crear una colecci√≥n, agregar elementos y realizar una consulta, puedes consultar el archivo [`0_quickstart`](./notebook/0_quickstart.ipynb).

Este notebook incluye ejemplos de:
- Creaci√≥n de un cliente.
- Creaci√≥n de una colecci√≥n.
- Inserci√≥n de puntos/vectores en una colecci√≥n.
- Recuperaci√≥n de los puntos/vectores m√°s cercanos.
- Aplicaci√≥n de filtros en las b√∫squedas.



**4. C√≥digo Python que muestra c√≥mo usar un LLM en conjunto con Qdrant**

Si quer√©s ver un ejemplo pr√°ctico de c√≥mo implementar RAG (Retrieval-Augmented Generation) utilizando OpenAI o Gemini y una base de conocimiento local, pod√©s consultar el archivo [`llm_api_examples_gemini_openai`](./notebook/llm_api_examples_gemini_openai.ipynb)

Este notebook incluye ejemplos de c√≥mo:
- Hacer una consulta simple a un modelo LLM (como GPT o Gemini).
- Conectar ese modelo a una fuente externa de datos (como un documento o colecci√≥n de texto).
- Combinar recuperaci√≥n de informaci√≥n y generaci√≥n de texto para responder preguntas con base en conocimiento personalizado.

## üîó Lectura recomendada
Recomendado para profundizar en los conceptos clave y ampliar tu comprensi√≥n
* [What is Qdrant?](https://qdrant.tech/documentation/overview/)
* [How Does Vector Search Work in Qdrant?](https://qdrant.tech/documentation/overview/vector-search/)
* [How to Get Started with Qdrant Locally](https://qdrant.tech/documentation/quickstart/)
* [Qdrant Web UI](https://qdrant.tech/documentation/web-ui/)
* [How to Generate Text Embedings with FastEmbed](https://qdrant.tech/documentation/fastembed/fastembed-quickstart/)
* [Using FastEmbed with Qdrant for Vector Search](https://qdrant.tech/documentation/fastembed/fastembed-semantic-search/)
* [Qdrant - Concepts](https://qdrant.tech/documentation/concepts/)
* [Estrellas en el cielo sem√°ntico: b√∫squeda vectorial con Qdrant](https://medium.com/@j92riquelme/estrellas-en-el-cielo-sem√°ntico-b√∫squeda-vectorial-con-qdrant-89072b49f418)
* [An Introduction to Vector Databases](https://qdrant.tech/articles/what-is-a-vector-database/)
* [Build Your First Semantic Search Engine](https://qdrant.tech/documentation/beginner-tutorials/search-beginners/)
* [A Complete Guide to Filtering in Vector Search](https://qdrant.tech/articles/vector-search-filtering/)


## üîó Videos recomendados
Selecci√≥n de videos para reforzar visualmente los temas abordados
* [What is RAG? Building Better LLM Systems with Qdrant](https://www.youtube.com/watch?v=rtIyQPJUd_U)
* [How Vector Search Algorithms Work: An Intro to Qdrant](https://www.youtube.com/watch?v=mXNrhyw4q84)
* [Exploring Qdrant concepts - Collections](https://www.youtube.com/watch?v=0sg7pJo0siU)
* [Qdrant Tutorial - Semantic Search for Beginners](https://www.youtube.com/watch?v=AASiqmtKo54)
* [Getting Started with Qdrant](https://youtu.be/LRcZ9pbGnno?si=0xPf3C9oGpR6BxRz)
* [Chatbot with RAG, using LangChain, OpenAI, and Groq](https://www.youtube.com/watch?v=O60-KuZZeQA)
* [Music Recommendation System with Qdrant Vector Search and Audio Embeddings](https://www.youtube.com/watch?v=id5ql-Abq4Y)


## Cursos adicionales recomendados
Recursos complementarios para seguir aprendiendo y fortaleciendo tus habilidades.

* [Retrieval Optimization: From Tokenization to Vector Quantization](https://www.deeplearning.ai/short-courses/retrieval-optimization-from-tokenization-to-vector-quantization/?utm_campaign=qdrant-launch&utm_medium=qdrant&utm_source=partner-promo)

---

> üìå **Nota:** este repositorio complementa el curso **LLM Zoomcamp** de [DataTalks.Club](https://datatalks.club/), y contiene notas, lecturas, videos, ejemplos y recursos adicionales.  
> Para acceder al contenido oficial del curso, visita el [**repositorio principal en GitHub**](https://github.com/DataTalksClub/llm-zoomcamp).
